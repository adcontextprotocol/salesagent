{% extends "base.html" %}

{% block title %}Login - Sales Agent Admin{% endblock %}

{% block content %}
<div class="card" style="max-width: 400px; margin: 4rem auto; text-align: center;">
    {% if test_mode %}
    <div style="background: #ff9800; color: white; padding: 1rem; margin: -2rem -2rem 1rem -2rem; border-radius: 4px 4px 0 0;">
        ⚠️ TEST MODE ENABLED - NOT FOR PRODUCTION
    </div>
    {% endif %}

    {% if tenant_context %}
        <h2>{{ tenant_name or tenant_context }} Sales Agent Dashboard</h2>
        <p style="color: #666; margin-bottom: 2rem;">Sales agent dashboard for {{ tenant_name or tenant_context }} team</p>
    {% elif tenant_id %}
        <h2>{{ tenant_name or tenant_id }} Sales Agent Dashboard</h2>
        <p style="color: #666; margin-bottom: 2rem;">Sales agent dashboard for {{ tenant_name or tenant_id }} team</p>
    {% else %}
        <h2>AdCP Sales Agent</h2>
        <p style="color: #666; margin-bottom: 2rem;">Administrator Access</p>
    {% endif %}

    {% if error %}
    <div class="alert alert-error">{{ error }}</div>
    {% endif %}

    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-error">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    {% if not test_mode and not oauth_configured %}
    <div style="margin: 2rem 0; padding: 1.5rem; background: #fff3cd; border-radius: 4px;">
        <p style="margin: 0; color: #856404;">
            <strong>Authentication not configured.</strong><br>
            Set <code>ADCP_AUTH_TEST_MODE=true</code> for test access, or configure OAuth credentials
            (<code>GOOGLE_CLIENT_ID</code>/<code>GOOGLE_CLIENT_SECRET</code> or generic OIDC).
        </p>
    </div>
    <p style="color: #666; font-size: 13px; margin-top: 1rem;">
        <a href="https://adcontextprotocol.org/sales-agent/deployment/environment-variables#authentication" target="_blank" style="color: #0066cc;">
            View authentication setup guide
        </a>
    </p>
    {% endif %}

    {% if test_mode %}
    <div style="margin: 2rem 0; padding: 2rem 0; border-top: 1px solid #ddd;">
        <h3 style="margin-bottom: 1rem;">Test Mode Login</h3>

        <div style="display: flex; flex-direction: column; gap: 0.75rem;">
            {% if not single_tenant_mode %}
            <!-- Super Admin button (multi-tenant only) -->
            <form method="POST" action="{{ url_for('auth.test_auth') }}" style="margin: 0;">
                <input type="hidden" name="email" value="test_super_admin@example.com">
                <input type="hidden" name="password" value="test123">
                <button type="submit" class="btn" style="width: 100%; background: #ff9800;">
                    Log in as Super Admin
                </button>
            </form>
            {% endif %}

            <!-- Tenant Admin button -->
            <form method="POST" action="{{ url_for('auth.test_auth') }}" style="margin: 0;">
                <input type="hidden" name="email" value="test_tenant_admin@example.com">
                <input type="hidden" name="password" value="test123">
                {% if tenant_context %}
                <input type="hidden" name="tenant_id" value="{{ tenant_context }}">
                {% elif tenant_id %}
                <input type="hidden" name="tenant_id" value="{{ tenant_id }}">
                {% endif %}
                <button type="submit" class="btn" style="width: 100%; background: {% if single_tenant_mode %}#ff9800{% else %}#6b7280{% endif %};">
                    Log in as {% if single_tenant_mode %}Admin{% else %}Tenant Admin{% endif %}
                </button>
            </form>
        </div>

        {% if not tenant_id and not tenant_context and not single_tenant_mode %}
        <p style="font-size: 12px; color: #666; margin-top: 1rem;">
            <strong>Note:</strong> Tenant Admin requires an account. Use a tenant-specific URL or create one first.
        </p>
        {% endif %}
    </div>
    {% endif %}

    <p style="color: #666; font-size: 14px; margin-top: 2rem;">
        {% if tenant_id or tenant_context %}
        Sales agent access only - {{ tenant_name or tenant_context or tenant_id }} employees.<br>
        Contact your team administrator if you need access.
        {% else %}
        Access is restricted to authorized administrators.<br>
        For tenant-specific access, use your tenant login URL.
        {% endif %}
    </p>

    {% if not tenant_id and not tenant_context %}
    <div style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #eee;">
        <p style="color: #666; font-size: 13px;">
            <strong>Tenant Access:</strong> Use your tenant-specific URL<br>
            <code>https://[tenant-subdomain].sales-agent.scope3.com</code><br>
            <code>https://[agent-name].adcontextprotocol.org</code>
        </p>
    </div>
    {% endif %}
</div>

<style>
.btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
}
</style>
{% endblock %}
