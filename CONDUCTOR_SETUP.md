# Conductor Workspace Setup Guide

This guide documents the automated setup process for Conductor workspace copies.

## Quick Start

Run the setup script from within a Conductor workspace:

```bash
./setup_conductor_workspace.sh
```

The script automatically:
- Detects the Conductor workspace using environment variables
- Assigns unique ports based on the workspace name
- Copies required files from the root workspace
- Configures the `.env` file with appropriate settings
- Updates `docker-compose.yml` defaults

## How It Works

The setup script uses Conductor-provided environment variables:
- `$CONDUCTOR_WORKSPACE_NAME` - The workspace name (e.g., "san-francisco")
- `$CONDUCTOR_WORKSPACE_PATH` - Path to the workspace directory
- `$CONDUCTOR_ROOT_PATH` - Path to the repository root

Unique ports are generated by creating a hash of the workspace name, ensuring consistent port allocation across runs.

## Port Configuration

Each workspace gets unique ports to avoid conflicts:

```bash
# Example ports for workspace "san-francisco"
POSTGRES_PORT=5456      # Base: 5432 + workspace number
ADCP_SALES_PORT=8104    # Base: 8080 + workspace number
ADMIN_UI_PORT=8025      # Base: 8001 + workspace number
```

## After Setup

Start the services:
```bash
docker-compose build
docker-compose up -d
```

## Verification

Check that all services are running:
```bash
docker-compose ps
```

Test endpoints (using example ports):
- MCP Server: `curl http://localhost:8104/mcp/`
- Admin UI: `http://localhost:8025/`
- PostgreSQL: `psql -h localhost -p 5456 -U adcp_user -d adcp`

## Important Notes

1. **OAuth Redirect URI**: If using Google OAuth, ensure the redirect URI in Google Console matches your Admin UI port (e.g., `http://localhost:8025/auth/google/callback`)

2. **Database URL**: The DATABASE_URL in `.env` is automatically configured to match the POSTGRES_PORT setting

3. **Consistent Ports**: The same workspace name will always get the same ports, making it easy to remember and bookmark

4. **Manual Override**: You can still manually edit the `.env` file if you need specific ports

## Troubleshooting

If you encounter issues:

1. **Port Conflicts**: Check if the assigned ports are already in use:
   ```bash
   lsof -i :PORT_NUMBER
   ```

2. **Missing Files**: Ensure you have the required files in the root workspace:
   - `.env` file with GEMINI_API_KEY
   - OAuth credentials (`client_secret*.json`)

3. **Database Issues**: The script includes checks for common database.py indentation problems and will warn if fixes are needed